<div class="row">
  <div class="card offset-3 col-6 shadow-lg mt-5">
    <div class="row">
      <div class="mt-3 ms-2 col-4 fw-bolder"><%= @knowledge.title %></div>
      <div class="mt-3 text-end col-7 fw-light text-secondary"><span class="position-absolute top-0 end-0 mt-3 me-4"><%= @knowledge.category.category_name %></span></div>
      <div class="mt-3"><%= @knowledge.body %></div>
      <div class="mt-3 mb-4"><%= raw Rinku.auto_link(@knowledge.url, :all, 'target="_blank"') %></div>
      <div class="text-end text-secondary"><%= @knowledge.created_at.strftime('%Y/%m/%d %H:%M') %></div>
      <% if @knowledge.user.id != current_user.id %>
        <div class="text-end"><%= link_to @knowledge.user.name, user_path(@knowledge.user.id), class: "text-decoration-none" %></div>
        <% if current_user.following?(@knowledge.user) %>
          <div class="text-end mb-2"><%= link_to "unfollow", user_relationship_path(@knowledge.user.id), data: { turbo_method: :delete }, class: "btn btn-outline-primary btn-sm" %></div>
        <% else %>
          <div class="text-end mb-2"><%= link_to "follow", user_relationships_path(@knowledge.user.id), data: { turbo_method: :post }, class: "btn btn-outline-primary btn-sm" %></div>
        <% end %>
      <% end %>
    </div>
  </div>
  <% if @knowledge.user.id == current_user.id %>
    <div class="card offset-2 col-8 shadow-lg mt-3 mb-5">
      <div>
        <%= render "layouts/error_messages", model: @knowledge %>
      </div>
      
      <%= form_with model: @knowledge, local: true do |f| %>
        <div class="row">
          <div class="offset-2 col-8 mt-3">
            <%= f.label :title, "タイトル", class: "form-label" %><br>
            <%= f.text_field :title, class: "form-control" %>
          </div>
        
          <div class="offset-2 col-8 mt-2">
            <%= f.label :body, "本文", class: "form-label" %><br>
            <%= f.text_area :body, class: "form-control", rows: 4 %>
          </div>
          
          <div class="offset-2 col-8 mt-2">
            <%= f.label :url, "URL", class: "form-label" %><br>
            <%= f.text_area :url, class: "form-control", rows: 3 %>
          </div>
          
          <div class="offset-2 col-8 mt-2">
            <%= f.label :category_id, "カテゴリー", class: "form-label" %><br>
            <%= f.collection_select :category_id, Category.all, :id, :category_name, { prompt: '選択してください' }, class: "form-select" %>
          </div>
          
          <div class="mt-3 mb-2 text-center">
            <%= f.submit "Edit", class: "btn btn-outline-success col-3" %>
          </div>
        </div>
      <% end %>
      <div class="text-center mt-2 mb-5">
        <%= link_to "Delete", knowledge_path(@knowledge.id), data: { turbo_method: :delete, turbo_confirm: "削除しますか?" }, status: :see_other, class: "btn btn-outline-danger col-3" %>
      </div>
    </div>
  <% end %>
</div>